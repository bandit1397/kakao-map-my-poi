<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì¹´ì¹´ì˜¤ë§µ ìœ„ì¹˜ ì €ì¥ â€” LocalStorage + Polyline + í¸ì§‘/ì‚­ì œ + CSV/JSON</title>

<!-- âœ… favicon ì—ëŸ¬ ë°©ì§€ -->
<link rel="icon" href="data:,">

<!-- âœ… ì¹´ì¹´ì˜¤ë§µ SDK ì •ì  ë¡œë“œ -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=91d4176cb6da4e212c947c5d549ac640&autoload=false&libraries=services,drawing"></script>

<style>
/* ğŸŒŸ ë†’ì´ í™•ë³´ */
html, body { height: 100%; margin:0; padding:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial; }
#map { width: 100%; height: 60vh; border:1px solid #dcdcdc; border-radius:12px; margin-bottom:12px; }

h1 { font-size: 20px; margin: 16px 0 10px; }
.toolbar { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px; }
button, input[type="text"] { padding:6px 10px; border:1px solid #dcdcdc; border-radius:8px; background:#fff; cursor:pointer; }
button:hover { background:#f6f6f6; }
.panel { display:grid; gap:10px; margin-bottom:12px; }
.list { border:1px solid #dcdcdc; border-radius:12px; padding:8px; max-height:260px; overflow:auto; }
.row { display:flex; align-items:center; gap:6px; padding:6px; border-bottom:1px dashed #eee; }
.row:last-child { border-bottom:none; }
.row .meta { flex:1; min-width:0; }
.row .meta .title { font-weight:600; font-size:13px; }
.row .meta .sub { color:#666; font-size:12px; }
.pill { padding:2px 6px; background:#f2f2f2; border-radius:999px; font-size:11px; }
.danger { color:#b00020; }
.foot { font-size:12px; color:#666; }
</style>
</head>
<body>

<h1>ì¹´ì¹´ì˜¤ë§µ ìœ„ì¹˜ ì €ì¥ â€” LocalStorage + Polyline + í¸ì§‘/ì‚­ì œ + CSV/JSON</h1>

<div id="map"></div>

<div class="toolbar">
    <button id="btnSave">ğŸ“ ë‚´ ìœ„ì¹˜ ì €ì¥</button>
    <button id="btnCenter">ğŸ¯ í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™</button>
    <button id="btnCsv">â¬‡ï¸ CSV ë‹¤ìš´ë¡œë“œ</button>
    <button id="btnJson">â¬‡ï¸ JSON ë‹¤ìš´ë¡œë“œ</button>
    <span class="pill" id="countPill">ì´ 0ê°œ</span>
</div>

<div class="panel">
    <div class="list" id="list"></div>
    <div class="foot">ğŸ’¡ ë§ˆì»¤ë¥¼ <b>í´ë¦­</b>í•˜ë©´ ì´ë¦„ í¸ì§‘ ë˜ëŠ” <span class="danger">ì‚­ì œ</span> ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
</div>

<script>
window.onload = function() {
    // âœ… ì¹´ì¹´ì˜¤ë§µ SDK ë¡œë“œ í›„ ì‹¤í–‰
    kakao.maps.load(function() {
        const container = document.getElementById('map');
        const options = { center: new kakao.maps.LatLng(37.5665, 126.9780), level: 5 };
        const map = new kakao.maps.Map(container, options);

        const markers = [];
        const polyline = new kakao.maps.Polyline({
            path: [],
            strokeWeight: 3,
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeStyle: 'solid'
        });
        polyline.setMap(map);

        const listEl = document.getElementById('list');
        const countPill = document.getElementById('countPill');

        // âœ… LocalStorageì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
        let points = JSON.parse(localStorage.getItem('savedPoints') || '[]');
        renderList();

        function renderList() {
            listEl.innerHTML = '';
            markers.forEach(m => m.setMap(null));
            markers.length = 0;
            const path = [];

            points.forEach((p, idx) => {
                const marker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng(p.lat, p.lng),
                    map: map
                });
                markers.push(marker);
                path.push(new kakao.maps.LatLng(p.lat, p.lng));

                kakao.maps.event.addListener(marker, 'click', function() {
                    const newName = prompt('ì´ë¦„ ìˆ˜ì • ë˜ëŠ” ì‚­ì œ (ê³µë°±ì…ë ¥ì‹œ ì‚­ì œ):', p.name);
                    if(newName === null) return;
                    if(newName.trim()==='') { points.splice(idx,1); }
                    else { points[idx].name = newName; }
                    savePoints();
                    renderList();
                });

                const row = document.createElement('div');
                row.className='row';
                row.innerHTML = `<div class="meta"><div class="title">${p.name}</div><div class="sub">${p.lat.toFixed(5)}, ${p.lng.toFixed(5)}</div></div>`;
                listEl.appendChild(row);
            });

            polyline.setPath(path);
            countPill.textContent = `ì´ ${points.length}ê°œ`;
        }

        function savePoints() {
            localStorage.setItem('savedPoints', JSON.stringify(points));
        }

        // ğŸ“ ë‚´ ìœ„ì¹˜ ì €ì¥
        document.getElementById('btnSave').addEventListener('click', function(){
            if(navigator.geolocation){
                navigator.geolocation.getCurrentPosition(function(pos){
                    const lat = pos.coords.latitude;
                    const lng = pos.coords.longitude;
                    const name = prompt('ì´ ìœ„ì¹˜ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', `ìœ„ì¹˜ ${points.length+1}`);
                    if(!name) return;
                    points.push({name, lat, lng});
                    savePoints();
                    renderList();
                });
            } else { alert('ìœ„ì¹˜ ê¸°ëŠ¥ ë¯¸ì§€ì› ë¸Œë¼ìš°ì €'); }
        });

        // ğŸ¯ í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™
        document.getElementById('btnCenter').addEventListener('click', function(){
            if(navigator.geolocation){
                navigator.geolocation.getCurrentPosition(function(pos){
                    map.setCenter(new kakao.maps.LatLng(pos.coords.latitude, pos.coords.longitude));
                });
            }
        });

        // CSV ë‹¤ìš´ë¡œë“œ
        document.getElementById('btnCsv').addEventListener('click', function(){
            const csv='ì´ë¦„,ìœ„ë„,ê²½ë„\n'+points.map(p=>`${p.name},${p.lat},${p.lng}`).join('\n');
            downloadFile('points.csv', csv);
        });

        // JSON ë‹¤ìš´ë¡œë“œ
        document.getElementById('btnJson').addEventListener('click', function(){
            const json = JSON.stringify(points,null,2);
            downloadFile('points.json', json);
        });

        function downloadFile(filename, content){
            const blob = new Blob([content], {type:'text/plain'});
            const a=document.createElement('a');
            a.href=URL.createObjectURL(blob);
            a.download=filename;
            a.click();
        }

        console.log('ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™” ì™„ë£Œ âœ…');
    });
};
</script>

</body>
</html>
